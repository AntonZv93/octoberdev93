---
- hosts: octoberinstance-1
sudo: yes
tasks:
- name: install packages
apt: name={{ item }} update_cache=yes state=latest
with_items: 
- git
- php
- php-cli
- php-mysql
-php-zip
- php-json 
-php-gd
- php-mbstring
- php-curl 
- php-xml
- php-pear
- php-bcmath 
- php-pdo
- openssl
- apache2 
- libapache2-mod-php
- unzip
-nano
- mariadb-server

notify:
- restart php
- restart apache2
- restart mariadb


- name: Clone git repository
git: >
dest=/octobermovie
repo=https://github.com/antonzv93/octoberdev93.git
update=no
sudo: yes
sudo_user: www-data
register: cloned
- name: install composer
shell: curl -sS https://getcomposer.org/api/installer | php -- --install-dir=/usr/local/bin --filename=composer
args:
creates: /usr/local/bin/composer
- name: composer create-project
composer: command=create-project
october/october
 working_dir=/octobermovie optimize_autoloader=no
sudo: yes
sudo_user: www-data
when: cloned|changed
- name: set APP_DEBUG=false
lineinfile: dest=/var/www/octobermovie/.env regexp='^APP_DEBUG=' line=APP_DEBUG=false
- name: set APP_ENV=production
lineinfile: dest=/octobermovie/.env regexp='^APP_ENV=' line=APP_ENV=production
- name: Configure octobermovie

handlers:
- name: restart php
service: name=php state=restarted
- name: restart apache2
service: name=apache2   state=restarted
-name: enable apache2
service: name=apache2 state=enable
-name: enable mariadb
service: name=mariadb state=enable
